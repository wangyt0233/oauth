<!DOCTYPE html>
<html>

<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge" />
 <title>湖北省工商行政管理局_用户中心</title>
 <link rel="shortcut icon" href="images/ico.png" />
 <link rel="stylesheet" type="text/css" href="styles/common.css" />
 <link rel="stylesheet" type="text/css" href="styles/uc.css" />
 <link href="https://cdn.bootcss.com/pixeden-stroke-7-icon/1.2.3/dist/pe-icon-7-stroke.min.css" rel="stylesheet" type="text/css">
 <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
</head>

<body>
    <div class="wrap">
        <div class="header">
            <div class="w1200">
                <h1><a href="login.html"><b class="nt">湖北省工商行政管理局</b><strong>认证平台</strong></a></h1>
                <div class="user-nav">
                    <ul>
                        <li class="current"><a href="#">首 页</a></li>
                        <li><a href="#">账户设置</a></li>
                        <li><a href="msg.html" target="mainFrame">消息中心<em>19</em></a></li>
                        <li><a href="developer.html" target="_blank" class="extra"><i class="pe-7s-science"></i>&ensp;开放平台</a></li>
                        <li class="line"><span></span></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="w1200">
                <div class="where"  >
                <h2 class="t1"><b>找回密码</b></h2>
                <div class="crumbs"><a href="#" class="home">用户中心</a>/<span class="current">找回密码</span></div>
                </div>
                <div class="pane">
                <div class="note">
                    <p class="tc"><i class="pe-7s-info vm" style="font-size: 20px"></i>&emsp;<span>您可以通过手机验证和人工申诉两种方式找回密码</span></p>
                </div>
                <ul class="jr-tab2">
                    <li class="current" style="width: 50%"><a href="javascript:"><i class="pe-7s-phone vm" style="font-size: 20px"></i>&emsp;手机验证找回</a></li>
                    <li style="width: 50%"><a href="javascript:"><i class="pe-7s-user vm" style="font-size: 20px"></i>&emsp;人工申诉找回</a></li>
                </ul>
                <div class="jr-forms">
                    <ul>
                        <li style="padding-left: 400px">
                            <label for="">手机号</label>
                            <input type="tel" class="inp disabled" value="15927582333" disabled="disabled" id="inp1">
                        </li>
                        <li style="padding-left: 400px">
                            <label for="">验证码</label>
                            <input type="text" class="inp" id="inp2">
                            <img src="http://localhost/HTEIP-page/security/captcha.htm" alt="" class="mr10" id="IMG"><a href="javascript:" id="toggle">看不清换一张</a>
                        </li>
                        <li style="padding-left: 400px">
                            <label for="">手机验证码</label>
                            <input type="text" class="inp" id="inp3">
                            <button class="btn btn-small btn-normal" id="btn">点击获取</button>
                        </li>
                        <li style="padding-left: 400px">
                            <label for="">身份证号码</label>
                            <input type="text" class="inp" id="inp4">
                        </li>
                        <li style="padding-left: 400px">
                            <label for="">新密码</label>
                            <input type="password" class="inp" id="inp5">
                        </li>
                        <li style="padding-left: 400px">
                            <label for="">确认密码</label>
                            <input type="password" class="inp" id="inp6">
                        </li>
                    </ul>
                    <div class="btns">
                        <a class="btn" href="javascript:;" id="ok">确定</a>
                        <input type="reset" class="btn btn-normal">
                    </div>
                </div>
                <div class="jr-forms" style="display: none;">
                    <ul>
                       <li style="padding-left: 400px">
                           <label for="">申请问题描述</label>
                           <textarea name=""  cols="30" rows="10"></textarea>
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">姓名</label>
                            <input type="text" class="inp">
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">证件类型</label>
                            <select name="" id=""><option value="">请选择</option></select>
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">证件号码</label>
                            <input type="number" class="inp">
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">手机号</label>
                            <input type="tel" class="inp">
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">证件正面照</label>
                            <button class="btn btn-small btn-lakeblue"><i class="pe-7s-photo"></i>&ensp;点击上传</button>
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">证件反面照</label>
                            <button class="btn btn-small btn-lakeblue"><i class="pe-7s-photo"></i>&ensp;点击上传</button>
                       </li>
                       <li style="padding-left: 400px">
                            <label for="">手持证件照</label>
                            <button class="btn btn-small btn-lakeblue"><i class="pe-7s-photo"></i>&ensp;点击上传</button>
                       </li>
                  </ul>
                    <div class="btns">
                         <a class="btn" href="javascript:;" >确定</a>
                         <input type="reset" class="btn btn-normal" id="Reset">
                    </div>
                </div>
            </div>
            </div>
        </div>
        <div class="footer">
            <div class="backtop"></div>
            <div class="copyright w1200">
                <p>地址：湖北省武汉市武昌区东湖路145号&emsp;&emsp;邮编：430077</p>
                <p>版权所有：湖北省工商行政管理局&emsp;&emsp;鄂ICP备05016233号&emsp;&emsp;技术支持：武汉佳软</p>
                <p>建议您使用IE9+、webkit内核、极速模式浏览器，分辨率1280*800及以上浏览本网站。</p>
                <div class="extra">
                    <div id="_ideConac"><img src="images/red.png" alt=""></div>
                    <div id="_span_jiucuo"><img src="images/jiucuo.png" alt=""></div>
                </div>
            </div>
        </div>
    </div>
 <!--js-->
 <script type="text/javascript" src="js/iframeResizer.min.js"></script>
 <script>
 //Dom option
 $(document).ready(function() {
     $("#inp1").focus();
     $("#toggle").click(function(){
         reImg();
     });
     //获取手机验证码
     var bool = true;
     $("#btn").click(function(){
         getMesCode();
         var time = 60;
         if(bool){
             getMesCode();
             $("#btn").text("重新发送"+"("+time+")s");
             bool = false;
             var t = setInterval(function  () {
                 time--;
                 if (time == 0) {
                     clearInterval(t);
                     $("#btn").text("获取验证码");;
                     bool = true;
                 }else{
                     $("#btn").text("重新发送"+"("+time+")s");

                 }
             },1000)

         }
     });
     //点击确定按钮
     $("#ok").click(function(){
         $phoneNumber = $("#inp1").val();
        $checkCode = $("#inp2").val();
        $mesCode = $("#inp3").val();
         $code = $("#inp4").val();
        $newpwd = $("#inp5").val();
        $renewpwd = $("#inp6").val();
        
        var token = $.getUrlParam("toke");
        if(!$checkCode || !$code || !$mesCode || !$newpwd || !$renewpwd){
            $(".tc span").text("身份证与验证码、密码不能为空！");
        }else{
            var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
            if(!$card || !reg.test($card) ){
                $(".tc span").text("身份证号码不合法");
            }else if($newpwd.length < 6 || $newpwd.length > 11){
                $(".tc span").text("密码格式不正确，请输入6到11位的密码！");
            }else if($newpwd != $renewpwd){
                $(".tc span").text("两次密码不一致");
            }
        }
         $.ajax({
             type:"GET",
             url:'http://localhost/HTEIP-page/security/forgetByphone.htm',
             data:{
                 phoneNumber:$phoneNumber,
                 captchaCode:$checkCode,
                 token:$code,
                 phoneCode:$mesCode,
                 Password:$newpwd,
             },
             cache:false,
             dataType:"json",
             contentType:"application/json;charset=utf-8",
             success:function(res){
                 if(res.code == '200'){
                     window.location.href = "http://localhost/HTEIP-page/oauth/login.html";
                     reImg();
                 }
             },
             error:function(err){
                 console.log(err.msg);
                 reImg();
             }

         });
     });
     //菜单和框架
     var t = $(".user-nav li, .my-menu li");
     t.click(function() {
         t.removeClass("current")
         $(this).addClass("current");
     });

     //tab
     $('.jr-tab2 li').click(function(event) {
         $(this).addClass("current").siblings().removeClass('current');
         $('.jr-forms').hide().eq($('.jr-tab2 li').index(this)).show();
     });

     //返回顶部
     $(".backtop").click(function() { $("html, body").animate({ scrollTop: 0 }, 500) });

     function backTop() {
         var st = $(document).scrollTop(),
             gt = $(".content").offset().top;
         st > gt ? $(".backtop").fadeIn(300) : $(".backtop").fadeOut(300);
     }
     $(window).bind("load scroll resize", backTop);
     //重置信息
     $("#reset").click(function(){
         $("#inp2").val("");
         $("#inp3").val("");
         $("#inp4").val("");
         $("#inp5").val("");
         $("#inp6").val("");
         reImg();
         $("#inp2").focus();
     })
    
 });
 //获取手机验证码
 function getMesCode() {
     var $card = $("#inp1").val();
     var $check = $("#inp2").val();
     if(!$card || !reg.test($card) ){
         $(".tc span").text("身份证号码不合法");
     }
     $.ajax({
         type:"GET",
         url:'http://localhost/HTEIP-page/security/forgetSendMsg.htm',
         data:{
             phoneNumber:$card,
             captchaCode:$check
         },
         dataType:"json",
         success:function(res){
             if(res.code == '200'){
                 $(".note .tc").text(res.msg);
                 console.log(res.msg);
             }else{
                 reImg();
                 $(".note .tc").text(res.msg);
             }

         },
         error:function(err){
             $(".note .tc").text(err.msg);
         }

     });
 }
 //获取token函数
 (function($) {
     $.getUrlParam = function(name) {
         var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
         var r = window.location.search.substr(1).match(reg);
         if(r != null) return decodeURI(r[2]);
         return null;
     }
 })(jQuery);
 //验证码切换刷新
 function reImg(){
     $("#IMG").attr("src","http://localhost/HTEIP-page/security/captcha.htm?r=" + Math.random());
 }
 </script>
</body>

</html>