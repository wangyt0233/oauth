<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>湖北省工商行政管理局_用户中心</title>
    <link rel="shortcut icon" href="images/ico.png" />
    <link rel="stylesheet" type="text/css" href="styles/common.css" />
    <link rel="stylesheet" type="text/css" href="styles/uc.css" />
    <link href="https://cdn.bootcss.com/pixeden-stroke-7-icon/1.2.3/dist/pe-icon-7-stroke.min.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <link rel="stylesheet" href="../core/miniui/themes/default/miniui.css">
</head>

<body>
    <div class="wrap">
        <div class="header">
            <div class="w1200">
                <h1><a href="login.html"><b class="nt">湖北省工商行政管理局</b><strong>认证平台</strong></a></h1>
                <div class="user-nav">
                    <ul>
                        <li class="current"><a href="#">首 页</a></li>
                        <li><a href="#">账户设置</a></li>
                        <li><a href="msg.html" target="mainFrame">消息中心<em>19</em></a></li>
                        <li><a href="developer.html" target="_blank" class="extra"><i class="pe-7s-science"></i>&ensp;开放平台</a></li>
                        <li class="line"><span></span></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="w1200">
                <div class="where">
                    <h2 class="t1"><b>找回密码</b></h2>
                    <div class="crumbs"><a href="#" class="home">用户中心</a>/<span class="current">找回密码</span></div>
                </div>
                <div class="pane">
                    <div class="note">
                        <p class="tc" id="tc1"><i class="pe-7s-info vm" style="font-size: 20px"></i>&emsp;<span>您可以通过手机验证和人工申诉两种方式找回密码</span></p>
                    </div>
                    <ul class="jr-tab2">
                        <li class="current" style="width: 50%"><a href="javascript:"><i class="pe-7s-phone vm" style="font-size: 20px"></i>&emsp;手机验证找回</a></li>
                        <li style="width: 50%"><a href="javascript:"><i class="pe-7s-user vm" style="font-size: 20px"></i>&emsp;人工申诉找回</a></li>
                    </ul>
                    <div class="jr-forms">
                        <ul>
                            <li style="padding-left: 400px">
                                <label for="">手机号</label>
                                <input type="tel" class="inp disabled" value="" disabled="disabled" id="inp" >
                            </li>
                           <li style="padding-left: 400px">
                                <label for="">证件号码</label>
                                <input type="text" class="inp" id="inp1" placeholder="请输入身份证号码">
                           </li>
                            <li style="padding-left: 400px">
                                <label for="">验证码</label>
                                <input type="text" class="inp" id="inp2" placeholder="请输入验证码">
                                <img src="/HTEIP-page/security/captcha.htm" alt="" class="mr10" id="IMG"><a href="javascript:" id="toggle">看不清换一张</a>
                            </li>
                           <li style="padding-left: 400px">
                                <label for="">手机验证码</label>
                                <input type="text" class="inp" id="inp3" placeholder="请输入手机验证码">
                                <button class="btn btn-small btn-normal" id="btn2">获取验证码</button>
                           </li>
                           <li style="padding-left: 400px">
                            <label for="">新密码</label>
                            <input type="password" class="inp" id="inp4" placeholder="请输入新密码">
                           </li>
                           <li style="padding-left: 400px">
                            <label for="">确认密码</label>
                            <input type="password" class="inp" id="inp5" placeholder="请再一次输入密码密码">
                           </li>
                        </ul>
                        <div class="btns">
                            <a class="btn" href="javascript:;" id="ok">确定</a>
                            <input type="reset" class="btn btn-normal" id="btn3">
                        </div>
                    </div>
                    <div class="jr-forms" style="display: none;">
                        <ul>
                           <li style="padding-left: 400px">
                               <label for="">申请问题描述</label>
                               <textarea name=""  cols="30" rows="10" id="question"></textarea>
                           </li>
                           <li style="padding-left: 400px">
                               <label for="">姓名</label>
                               <input type="text" class="inp" id="Name">
                           </li>
                           <li style="padding-left: 400px">
                                <label for="">证件号码</label>
                                <input type="text" class="inp" id="CerCode">
                           </li>
                           <li style="padding-left: 400px">
                                <label for="">手机号</label>
                                <input type="tel" class="inp tel"  id="Telphone">
                           </li>
                           <li style="padding-left: 400px">
                                <label for="">证件正面照</label>
                                <button class="btn btn-small btn-lakeblue"><i class="pe-7s-photo" id="faceImg"></i>&ensp;点击上传</button>
                               <a href="#" class="btn btn-small btn-lakeblue " id="imgs" style="background: orange;opacity: 0">点击查看</a>
                           </li>
                           <li style="padding-left: 400px">
                                <label for="">证件反面照</label>
                                <button class="btn btn-small btn-lakeblue" id="fanImg"><i class="pe-7s-photo"></i>&ensp;点击上传</button>
                               <a href="#" class="btn btn-small btn-lakeblue " id="Image" style="background: orange;opacity: 0">点击查看</a>
                           </li>
                           <li style="padding-left: 400px">
                                <label for="">手持证件照</label>
                                <button class="btn btn-small btn-lakeblue" id="hand"><i class="pe-7s-photo"></i>&ensp;点击上传</button>
                               <a href="#" class="btn btn-small btn-lakeblue " id="IM" style="background: orange;opacity: 0">点击查看</a>
                           </li>
                        </ul>
                        <div class="btns">
                            <a class="btn" href="javascript:;" id="imgBtn">确定</a>
                            <input type="reset" class="btn btn-normal">
                        </div>
                    </div>
                </div>
           </div>
        </div>
        <div class="footer">
           <div class="backtop"></div>
           <div class="copyright w1200">
            <p>地址：湖北省武汉市武昌区东湖路145号&emsp;&emsp;邮编：430077</p>
            <p>版权所有：湖北省工商行政管理局&emsp;&emsp;鄂ICP备05016233号&emsp;&emsp;技术支持：武汉佳软</p>
            <p>建议您使用IE9+、webkit内核、极速模式浏览器，分辨率1280*800及以上浏览本网站。</p>
            <div class="extra">
             <div id="_ideConac"><img src="images/red.png" alt=""></div>
             <div id="_span_jiucuo"><img src="images/jiucuo.png" alt=""></div>
            </div>
           </div>
          </div>
 </div>
 <!--js-->
    <script type="text/javascript" src="js/iframeResizer.min.js"></script>
    <script type="text/javascript" src="layer/layer.js"></script>
    <script type="text/javascript" src="../core/miniui/miniui.js"></script>
    <script type="text/javascript" src="../core/script/validate.js"></script>
    <script type="text/javascript" src="../core/fileupload/fileupload.js"></script>
    <script type="text/javascript" src="../scripts/document/preview.js"></script>
 <script>
 //Dom option
 $(document).ready(function() {
//菜单和框架
     var t = $(".user-nav li, .my-menu li");
     t.click(function () {
         t.removeClass("current");
         $(this).addClass("current");
     });

     //tab
     $('.jr-tab2 li').click(function (event) {
         $(this).addClass("current").siblings().removeClass('current');
         $('.jr-forms').hide().eq($('.jr-tab2 li').index(this)).show();
     });

     //返回顶部
     $(".backtop").click(function () {
         $("html, body").animate({scrollTop: 0}, 500);
     });

	 //默认手机号码设置
	 var num = $.getUrlParam("num");
     var token = $.getUrlParam('toke');
	 $("#inp").val(num);
     $("#inp1").focus();
     $(".tel").val(num);
     //切换验证码
     $("#toggle").click(function(){
         reImg();
     });
    //手机方式找回密码—————————————————————————————————————————————
	//获取短信验证码
     $("#btn2").click(function () {
         if(getCode() == "200") {
        	 var bool = true;
             var time = 60;
             if (bool) {
                 $("#btn2").text("重新发送" + "(" + time + ")s");
                 bool = false;
                 var t = setInterval(function () {
                     time--;
                     if (time == 0) {
                         clearInterval(t);
                         $("#btn2").text("获取验证码");
                         bool = true;
                     } else {
                         $("#btn2").text("重新发送" + "(" + time + ")s");

                     }
                 }, 1000)

             }
         }
     });
     //重置信息
     $("#btn3").click(function () {
         $("#inp1").val("");
         $("#inp2").val("");
         $("#inp3").val("");
         $("#inp4").val("");
         $("#inp5").val("");
         $("#tc1 span").val("您可以通过手机验证和人工申诉两种方式找回密码");
         $("#btn2").text("获取验证码");
         reImg();
         $("#inp1").focus();
     });
     
     //点击确定
     $("#ok").click(function () {
         $("#inp").val();
         var $phoneNumber = $("#inp").val();
         var $code = $("#inp1").val();
         var $checkCode = $("#inp2").val();
         var $msgcode = $("#inp3").val();
         var $newpwd = $("#inp4").val();
         var $renewcode = $("#inp5").val();
         var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
         if(!$code){
             $("#tc1 span").text("证件号码不能为空！");
             return;
         }else if(!reg.test($code)) {
             $("#tc1 span").text("身份证号码不合法！");
             return;
         }else if(!$checkCode){
             $("#tc1 span").text("图片验证码不能为空！");
             return;
         }else if(!$msgcode){
             $("#tc1 span").text("手机验证码不能为空！");
             return;
         } else if(!$newpwd){
             $("#tc1 span").text("密码不能为空！");
             return;
         }else if($newpwd.length < 6 || $newpwd.length > 11 ){
             $("#tc1 span").text("密码长度为6位至11位！");
         }else if(!$renewcode) {
             $("#tc1 span").text("请再一次输入密码！！");
             return;
         }else if($newpwd != $renewcode) {
             $("#tc1 span").text("两次密码必须填写一致！");
             return;
         }else{
             $("#tc1 span").text("信息正确！");
         }
         $.ajax({
             type: "GET",
             url: '/HTEIP-page/security/forgetByphone.htm',
             data: {
                 phoneNumber: $phoneNumber,
                 captchaCode: $checkCode,
                 token: token,
                 cardNumber: $code,
                 phoneCode: $msgcode,
                 password: $newpwd
             },
             cache: false,
             dataType: "json",
             contentType: "application/json;charset=utf-8",
             success: function (res) {
                 console.log(res);
                 if (res.code == '200') {
                     window.location.href = "/HTEIP-page/oauth/login.html";
                     reImg();
                 }else if(res.code == '-3'){
                     $("#tc1 span").text("手机验证码错误！");
                 }

             },
             error: function (err) {
                 console.log(err.msg);
                 reImg();
             }

         });
         
         




         function backTop() {
             var st = $(document).scrollTop(),
                 gt = $(".content").offset().top;
             st > gt ? $(".backtop").fadeIn(300) : $(".backtop").fadeOut(300);
         }

         $(window).bind("load scroll resize", backTop);

     });


    // 人工申诉方式找回密码***************************************************8
     //图片上传
     var bol = false;
     var boling = false;
     var bool = false;
     $("#faceImg").click(function() {
         var data = {
             basePath: "/HTEIP-page/",
             title: '证件正面照',
             width: 500,
             height: 270,
             type: 'image',
             savePath: '/legalAuth/images/',
             fileNum: 1,
             size: 1

         };
         uploadFile(data,function(file){
             URL = file[0].downloadUrl;
             bol = true;
             var url = file[0].downloadUrl;
             url = url.replace('fileupload/downloadfile', 'nonlogin/fileupload/downloadfile');
             console.log(url);

             var imgUrl = 'http://localhost/HTEIP-page/'+url;
             console.log(imgUrl);
             //1. 转换URL
             // 2. href
             $("#imgs").css("opacity",1);
             $("#imgs").click(function () {
                 top.layer.open({
                     title:"证件正面照",
                     type: 1,
                     area: ['600px', '560px'],
                     shade:['0.8','#ccc'],
                     shadeClose:true,
                     content: '<div id="" class="layui-layer-content"><div id="tong" class="hide layui-layer-wrap" style="display: block;"><img width="550" height="500" src="'+imgUrl+'"></div></div>'
                 })
             });


         });


     });
     $("#fanImg").click(function() {
         var data = {
             basePath: "/HTEIP-page/",
             title: '证件反面照',
             width: 500,
             height: 270,
             type: 'image',
             savePath: '/legalAuth/images/',
             fileNum: 1,
             size: 1

         };
         uploadFile(data,function(file){
             URLImage = file[0].downloadUrl;
             boling = true;
             var url = file[0].downloadUrl;
             url = url.replace('fileupload/downloadfile', 'nonlogin/fileupload/downloadfile');
             console.log(url);

             var imgUrl = 'http://localhost/HTEIP-page/'+url;
             console.log(imgUrl);
             //1. 转换URL
             // 2. href
             $("#Image").css("opacity",1);
             $("#Image").click(function () {
                 top.layer.open({
                     title:"证件反面照面照",
                     type: 1,
                     area: ['600px', '560px'],
                     shade:['0.8','#ccc'],
                     shadeClose:true,
                     content: '<div id="" class="layui-layer-content"><div id="tong" class="hide layui-layer-wrap" style="display: block;"><img width="550" height="500" src="'+imgUrl+'"></div></div>'
                 })
             });


         });


     });
     $("#hand").click(function() {
         var data = {
             basePath: "/HTEIP-page/",
             title: '手持证件照',
             width: 500,
             height: 270,
             type: 'image',
             savePath: '/legalAuth/images/',
             fileNum: 1,
             size: 1

         };
         uploadFile(data,function(file){
             URLIM = file[0].downloadUrl;
             bool = true;
             var url = file[0].downloadUrl;
             url = url.replace('fileupload/downloadfile', 'nonlogin/fileupload/downloadfile');
             console.log(url);

             var imgUrl = 'http://localhost/HTEIP-page/'+url;
             console.log(imgUrl);
             //1. 转换URL
             // 2. href
             $("#IM").css("opacity",1);
             $("#IM").click(function () {
                 top.layer.open({
                     title:"证件反面照面照",
                     type: 1,
                     area: ['600px', '560px'],
                     shade:['0.8','#ccc'],
                     shadeClose:true,
                     content: '<div id="" class="layui-layer-content"><div id="tong" class="hide layui-layer-wrap" style="display: block;"><img width="550" height="500" src="'+imgUrl+'"></div></div>'
                 })
             });


         });


     });
     //提交表单
     $("#imgBtn").on('click',function () {
        $question = $("#question").val();
         $Name = $("#Name").val();
        $CerCode = $("#CerCode").val();
        $Telphone = $("#Telphone").val();
         var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
        if(!$question){
            $("#tc1 span").text("申请问题描述不能为空！");
            return;
        }else if(!$Name){
            $("#tc1 span").text("姓名不能为空！");
            return;
        }else if(!$CerCode){
            $("#tc1 span").text("证件号码不能为空！");
            return;
        }else if(!reg.test($CerCode)){
            $("#tc1 span").text("证件号码不合法！");
            return;
        }else if( bol == false){
            $("#tc1 span").text("请上传证件正面照！");
            return;
        }else if(boling == false){
            $("#tc1 span").text("请上传证件正面照！");
            return;
        }else if(bool == false){
            $("#tc1 span").text("请上传手持证件照！");
            return;
        }else{
            $("#tc1 span").text("信息正确！");
        }
        var param = {
            userRealName:$Name,
            descript:$question,
            cardNumber:$CerCode,
            phoneNumber:$Telphone,
            cardPhotoPositive:URL,
            cardPhotoBack:URLImage,
            cardHandPhoto:URLIM
        }
         $.ajax({
             type: "GET",
             url: '/HTEIP-page/security/forgetByPerson.htm',
             data: {
                 token: token,
                 form:JSON.stringify(param)

             },
             cache: false,
             dataType: "json",
             contentType: "application/json;charset=utf-8",
             success: function (res) {
                 console.log(res);
                 if (res.code == '200') {
                     reImg();
                     top.layer.open({
                         title: '温馨提示',
                         time:0
                         ,content: '密码将于24小时之内以短信的形式发送至您！'
                     });
                     window.location.reload();
                 }else if(res.code == '-3'){
                     $("#tc1 span").text("手机验证码错误！");
                 }

             },
             error: function (err) {
                 console.log(err);
                 reImg();
             }

         });
     });

     
 })
 //获取验证码
 function getCode() {
	 var result;
	 var $num = $("#inp").val();
     var $code = $("#inp1").val();
     var $checkCode = $("#inp2").val();
     var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
     if (!$code) {
         $("#tc1 span").text("身份证号码不能为空!");
         return;
     }else if(!$checkCode){
         $("#tc1 span").text("图形验证码不能为空!");
     }else if(!reg.test($code)){
         $("#tc1 span").text("身份证号码不合法!");
     }
     $.ajax({
         type: "GET",
         async: false,
         url: '/HTEIP-page/security/forgetSendMsg.htm',
         data: {
        	 phoneNumber:$num,
             captchaCode: $checkCode,
             cardNumber: $code
         },
         dataType: "json",
         success: function (res) {
             console.log(res);
        	 result = res.code;
             if (res.code == '200') {
                 $("#tc1 span").text(res.msg);
                 console.log(res.msg);
             }else if(res.code == '-2'){
                 $("#tc1 span").text("图形验证码错误");
             }

         },
         error: function (err) {
        	 $("#tc1 span").text(err.msg);
         }

     });
     return result;
 }
 //验证码切换刷新
 function reImg(){
     $("#IMG").attr("src","/HTEIP-page/security/captcha.htm?r=" + Math.random());
 }
 //获取
 (function($) {
     $.getUrlParam = function(name) {
         var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
         var r = window.location.search.substr(1).match(reg);
         if(r != null) return decodeURI(r[2]);
         return null;
     }
 })(jQuery);
 
 </script>
</body>

</html>